<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RBUD</title>
  <style>
    :root { --border:#ddd; --bg:#fafafa; --text:#111; --muted:#666; }
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, "Segoe UI", sans-serif; color: var(--text); }
    .app { display: grid; grid-template-columns: 320px 1fr; height: 100vh; }
    aside { border-right: 1px solid var(--border); background: var(--bg); overflow: auto; }
    main { overflow: hidden; }
    header { padding: 14px 14px 10px; border-bottom: 1px solid var(--border); }
    .brand { font-weight: 700; }
    .hint { color: var(--muted); font-size: 12px; margin-top: 6px; }

    .nav { padding: 10px; }
    details { border: 1px solid var(--border); border-radius: 10px; background: #fff; margin-bottom: 10px; }
    summary { cursor: pointer; padding: 10px 12px; font-weight: 600; user-select: none; }
    .items { padding: 6px 0 10px; }
    .item {
      display: block; width: 100%; text-align: left;
      padding: 9px 12px; border: 0; background: transparent; cursor: pointer;
      color: #111; font-size: 14px;
    }
    .item:hover { background: #f2f2f2; }
    .item.active { background: #e9eefc; }

    .viewer {
      width: 100%; height: 100%;
      border: 0;
    }

    /* 小画面は縦積み */
    @media (max-width: 900px) {
      .app { grid-template-columns: 1fr; grid-template-rows: auto 1fr; }
      aside { border-right: 0; border-bottom: 1px solid var(--border); }
    }
  </style>
</head>
<body>
  <div class="app">
    <aside>
      <header>
        <div class="brand">RBUD</div>
        <div class="hint">左の項目をクリックすると右に表示</div>
      </header>

      <nav class="nav">
        <details open>
          <summary>プロジェクト：街路樹</summary>
          <div class="items">
            <button class="item" data-src="pages/welcome.html">はじめに</button>
            <button class="item" data-src="pages/aaa-tekyo-20250627_1.html">申入書 2025-06-27（PDF）</button>
          </div>
        </details>

        <details>
          <summary>プロジェクト：照明</summary>
          <div class="items">
            <button class="item" data-src="pages/welcome.html#lighting">LED更新（メモ）</button>
          </div>
        </details>

        <details>
          <summary>プロジェクト：道路法</summary>
          <div class="items">
            <button class="item" data-src="pages/welcome.html#roadact">道路法メモ</button>
          </div>
        </details>
      </nav>
    </aside>

    <main>
      <iframe id="viewer" class="viewer" src="pages/welcome.html" title="RBUD Viewer"></iframe>
    </main>
  </div>

  <script>
    const viewer = document.getElementById("viewer");
    const items = Array.from(document.querySelectorAll(".item"));

    function setActive(btn) {
      items.forEach(b => b.classList.toggle("active", b === btn));
    }

    function openSrc(src, btn, push = true) {
      viewer.src = src;
      if (btn) setActive(btn);
      if (push) history.pushState({ src }, "", "#" + encodeURIComponent(src));
    }

    // クリックで表示
    items.forEach(btn => {
      btn.addEventListener("click", () => openSrc(btn.dataset.src, btn));
    });

    // 直リンク（#pages/xxx.html）対応
    function loadFromHash() {
      const h = location.hash.slice(1);
      if (!h) return;
      const src = decodeURIComponent(h);
      const btn = items.find(b => b.dataset.src === src);
      openSrc(src, btn || null, false);

      // ボタンが属するdetailsを自動で開く（見つかる場合）
      if (btn) {
        const details = btn.closest("details");
        if (details) details.open = true;
      }
    }

    window.addEventListener("popstate", (e) => {
      if (e.state && e.state.src) {
        const btn = items.find(b => b.dataset.src === e.state.src);
        openSrc(e.state.src, btn || null, false);
      } else {
        loadFromHash();
      }
    });

    loadFromHash();
  </script>
</body>
</html>
